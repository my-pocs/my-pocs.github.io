<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="986px" preserveAspectRatio="none" style="width:1045px;height:986px;background:#FFFFFF;" version="1.1" viewBox="0 0 1045 986" width="1045px" zoomAndPan="magnify"><defs><filter height="300%" id="fy1sydev4tpdv" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fy1sydev4tpdv)" height="394.2578" style="stroke:#000000;stroke-width:2.0;" width="647" x="384" y="490.5547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="92" x2="92" y1="88.2969" y2="901.8125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="309.5" x2="309.5" y1="88.2969" y2="901.8125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="457" x2="457" y1="88.2969" y2="901.8125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="676" x2="676" y1="88.2969" y2="901.8125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="885" x2="885" y1="88.2969" y2="901.8125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="978" x2="978" y1="88.2969" y2="901.8125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169" x="5" y="84.9951">Розробник регламенту</text><ellipse cx="92.5" cy="15" fill="#FEFECE" filter="url(#fy1sydev4tpdv)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M92.5,23 L92.5,50 M79.5,31 L105.5,31 M92.5,50 L79.5,65 M92.5,50 L105.5,65 " fill="none" filter="url(#fy1sydev4tpdv)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169" x="5" y="913.8076">Розробник регламенту</text><ellipse cx="92.5" cy="927.1094" fill="#FEFECE" filter="url(#fy1sydev4tpdv)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M92.5,935.1094 L92.5,962.1094 M79.5,943.1094 L105.5,943.1094 M92.5,962.1094 L79.5,977.1094 M92.5,962.1094 L105.5,977.1094 " fill="none" filter="url(#fy1sydev4tpdv)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#fy1sydev4tpdv)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="100" x="257.5" y="36.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="274.5" y="56.6982">Сховище</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="264.5" y="72.9951">регламенту</text><rect fill="#FEFECE" filter="url(#fy1sydev4tpdv)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="100" x="257.5" y="900.8125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="274.5" y="920.8076">Сховище</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="264.5" y="937.1045">регламенту</text><rect fill="#FEFECE" filter="url(#fy1sydev4tpdv)" height="62.8906" style="stroke:#A80036;stroke-width:1.5;" width="123" x="394" y="20.4063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="420" y="40.4014">Пайплайн</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="401" y="56.6982">публікацій змін</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="401" y="72.9951">до регламенту</text><rect fill="#FEFECE" filter="url(#fy1sydev4tpdv)" height="62.8906" style="stroke:#A80036;stroke-width:1.5;" width="123" x="394" y="900.8125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="420" y="920.8076">Пайплайн</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="401" y="937.1045">публікацій змін</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="401" y="953.4014">до регламенту</text><rect fill="#FEFECE" filter="url(#fy1sydev4tpdv)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="139" x="605" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="612" y="72.9951">Keycloak-operator</text><rect fill="#FEFECE" filter="url(#fy1sydev4tpdv)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="139" x="605" y="900.8125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="612" y="920.8076">Keycloak-operator</text><rect fill="#FEFECE" filter="url(#fy1sydev4tpdv)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="75" x="846" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="853" y="72.9951">Keycloak</text><rect fill="#FEFECE" filter="url(#fy1sydev4tpdv)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="75" x="846" y="900.8125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="853" y="920.8076">Keycloak</text><rect fill="#FEFECE" filter="url(#fy1sydev4tpdv)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="82" x="935" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="942" y="72.9951">OpenShift</text><rect fill="#FEFECE" filter="url(#fy1sydev4tpdv)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="82" x="935" y="900.8125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="942" y="920.8076">OpenShift</text><polygon fill="#A80036" points="297.5,130.5625,307.5,134.5625,297.5,138.5625,301.5,134.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="92.5" x2="303.5" y1="134.5625" y2="134.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="99.5" y="121.9302">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="112.5" y="114.3638">Оновлення файлу</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="112.5" y="129.4966">trembita/consumers.yml</text><path d="M97,147.5625 L97,232.5625 L221,232.5625 L221,157.5625 L211,147.5625 L97,147.5625 " fill="#FBFB77" filter="url(#fy1sydev4tpdv)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M211,147.5625 L211,157.5625 L221,157.5625 L211,147.5625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37" x="103" y="164.6294">name</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="103" y="179.7622">description</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="103" y="194.895">subsystemCode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="103" y="210.0278">memberClass</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="103" y="225.1606">memberCode</text><polygon fill="#A80036" points="320.5,274.4922,310.5,278.4922,320.5,282.4922,316.5,278.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="314.5" x2="456.5" y1="278.4922" y2="278.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="326.5" y="265.8599">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="339.5" y="258.2935">Отримання</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="339.5" y="273.4263">змін регламенту</text><path d="M354,291.4922 L354,316.4922 L556,316.4922 L556,301.4922 L546,291.4922 L354,291.4922 " fill="#FBFB77" filter="url(#fy1sydev4tpdv)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M546,291.4922 L546,301.4922 L556,301.4922 L546,291.4922 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="360" y="308.5591">Інші кроки з публікації змін</text><polygon fill="#A80036" points="664.5,388.1563,674.5,392.1563,664.5,396.1563,668.5,392.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="457.5" x2="670.5" y1="392.1563" y2="392.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="464.5" y="364.3911">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="477.5" y="341.6919">Додавання</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="477.5" y="356.8247">нових ролей у CR</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="477.5" y="371.9575">KeycloakRealmRoleBatch</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="159" x="477.5" y="387.0903">external-system-roles</text><polygon fill="#A80036" points="873.5,417.2891,883.5,421.2891,873.5,425.2891,877.5,421.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="879.5" y1="421.2891" y2="421.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="683.5" y="416.2231">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="696.5" y="416.2231">Створення нових ролей</text><path d="M784,434.2891 L784,474.2891 L982,474.2891 L982,444.2891 L972,434.2891 L784,434.2891 " fill="#FBFB77" filter="url(#fy1sydev4tpdv)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M972,434.2891 L972,444.2891 L982,444.2891 L972,434.2891 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="790" y="451.356">Всі операції виконуються</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="790" y="466.4888">у реалмі</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="118" x="849" y="466.4888">external-system</text><path d="M384,490.5547 L461,490.5547 L461,497.5547 L451,507.5547 L384,507.5547 L384,490.5547 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="394.2578" style="stroke:#000000;stroke-width:2.0;" width="647" x="384" y="490.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="399" y="503.6216">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="280" x="476" y="502.7651">[для кожного нового зовнішнього клієнту]</text><polygon fill="#A80036" points="664.5,539.9531,674.5,543.9531,664.5,547.9531,668.5,543.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="457.5" x2="670.5" y1="543.9531" y2="543.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="464.5" y="531.3208">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="477.5" y="523.7544">Створення CR</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="477.5" y="538.8872">Keycloak Client</text><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="718.5" y1="588.2188" y2="588.2188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="718.5" x2="718.5" y1="588.2188" y2="601.2188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="677.5" x2="718.5" y1="601.2188" y2="601.2188"/><polygon fill="#A80036" points="687.5,597.2188,677.5,601.2188,687.5,605.2188,683.5,601.2188" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="683.5" y="575.5864">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="696.5" y="568.02">Генерація паролю</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="696.5" y="583.1528">для Keycloak CLient</text><polygon fill="#A80036" points="966,641.4844,976,645.4844,966,649.4844,970,645.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="972" y1="645.4844" y2="645.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="683.5" y="632.8521">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="696.5" y="625.2856">Створення Secret</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="696.5" y="640.4185">з паролем Keycloak Client</text><polygon fill="#A80036" points="873.5,685.75,883.5,689.75,873.5,693.75,877.5,689.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="676.5" x2="879.5" y1="689.75" y2="689.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="683.5" y="677.1177">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="696.5" y="669.5513">Створення Keycloak client</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="696.5" y="684.6841">(service-account)</text><path d="M681,702.75 L681,727.75 L943,727.75 L943,712.75 L933,702.75 L681,702.75 " fill="#FBFB77" filter="url(#fy1sydev4tpdv)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M933,702.75 L933,712.75 L943,712.75 L933,702.75 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="687" y="719.8169">clientSecret = згенерований пароль</text><polygon fill="#A80036" points="468.5,769.1484,458.5,773.1484,468.5,777.1484,464.5,773.1484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="462.5" x2="675.5" y1="773.1484" y2="773.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="474.5" y="760.5161">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="487.5" y="752.9497">Посилання на Secret</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="487.5" y="768.0825">у статусі CR Keycloak Client</text><polygon fill="#A80036" points="966,828.5469,976,832.5469,966,836.5469,970,832.5469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="457.5" x2="972" y1="832.5469" y2="832.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="464.5" y="812.3481">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="486.5" y="797.2153">Отримання</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="486.5" y="812.3481">OpenShift Secret</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="486.5" y="827.481">за посиланням</text><polygon fill="#A80036" points="468.5,872.8125,458.5,876.8125,468.5,880.8125,464.5,876.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="462.5" x2="977" y1="876.8125" y2="876.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="474.5" y="864.1802">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="496.5" y="856.6138">Secret з паролем</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="496.5" y="871.7466">Keycloak Client</text><!--MD5=[ad03099584b370050982a28178a7c722]
@startuml
actor "Розробник регламенту" as dev
participant "Сховище\nрегламенту" as gerrit
participant "Пайплайн\nпублікацій змін\nдо регламенту" as pipe
participant "Keycloak-operator" as keycloak_operator
participant "Keycloak" as keycloak
participant "OpenShift" as openshift

autonumber

dev -> gerrit : Оновлення файлу\n**trembita/consumers.yml**
note right of dev
name
description
subsystemCode
memberClass
memberCode
end note
pipe -> gerrit : Отримання\nзмін регламенту
note over pipe : Інші кроки з публікації змін
pipe -> keycloak_operator : Додавання\nнових ролей у CR\nKeycloakRealmRoleBatch\n**external-system-roles**
keycloak_operator -> keycloak : Створення нових ролей
note over of keycloak
Всі операції виконуються
у реалмі **external-system**
end note
loop для кожного нового зовнішнього клієнту
pipe -> keycloak_operator : Створення CR\nKeycloak Client
keycloak_operator -> keycloak_operator : Генерація паролю\nдля Keycloak CLient
keycloak_operator -> openshift : Створення Secret\nз паролем Keycloak Client
keycloak_operator -> keycloak : Створення Keycloak client\n(service-account)
note right of keycloak_operator
clientSecret = згенерований пароль
end note
keycloak_operator - -> pipe: Посилання на Secret\nу статусі CR Keycloak Client
pipe -> openshift: Отримання\nOpenShift Secret\nза посиланням
openshift - -> pipe: Secret з паролем\nKeycloak Client
end
@enduml

PlantUML version 1.2021.7(Sun May 23 12:40:07 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>