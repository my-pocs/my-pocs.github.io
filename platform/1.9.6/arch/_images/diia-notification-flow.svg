<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1888px" preserveAspectRatio="none" style="width:1892px;height:1888px;background:#FFFFFF;" version="1.1" viewBox="0 0 1892 1888" width="1892px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1876.1484" style="stroke:#2688D4;stroke-width:1.0;" width="603" x="501.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="251" x="677.5" y="18.0669">Сервіс нотифікацій користувачів</text><rect fill="#FFFFFF" height="1499.9688" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="584.5" y="321.5859"/><rect fill="#FFFFFF" height="1724.8281" style="stroke:#000000;stroke-width:2.0;" width="1876" x="9" y="89.7266"/><rect fill="#FFFFFF" height="1606.625" style="stroke:#000000;stroke-width:2.0;" width="1661.5" x="19" y="113.8594"/><rect fill="#FFFFFF" height="31.1328" style="stroke:#000000;stroke-width:2.0;" width="399.5" x="284" y="731.2422"/><rect fill="#FFFFFF" height="31.1328" style="stroke:#000000;stroke-width:2.0;" width="399.5" x="284" y="1276.6953"/><rect fill="#FFFFFF" height="87.0703" style="stroke:none;stroke-width:1.0;" width="1876" x="9" y="1727.4844"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="392" x2="392" y1="72.7266" y2="1831.5547"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="589.5" x2="589.5" y1="72.7266" y2="1831.5547"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="915.5" x2="915.5" y1="72.7266" y2="1831.5547"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1048.5" x2="1048.5" y1="72.7266" y2="1831.5547"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1421" x2="1421" y1="72.7266" y2="1831.5547"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1581" x2="1581" y1="72.7266" y2="1831.5547"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1761" x2="1761" y1="72.7266" y2="1831.5547"/><path d="M299,30.1328 L486,30.1328 C491,30.1328 491,51.4297 491,51.4297 C491,51.4297 491,72.7266 486,72.7266 L299,72.7266 C294,72.7266 294,51.4297 294,51.4297 C294,51.4297 294,30.1328 299,30.1328 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M486,30.1328 C481,30.1328 481,51.4297 481,51.4297 C481,72.7266 486,72.7266 486,72.7266 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="177" x="299" y="48.1279">'diia-channel-notifications'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="350" y="64.4248">Kafka Topic</text><path d="M299,1830.5547 L486,1830.5547 C491,1830.5547 491,1851.8516 491,1851.8516 C491,1851.8516 491,1873.1484 486,1873.1484 L299,1873.1484 C294,1873.1484 294,1851.8516 294,1851.8516 C294,1851.8516 294,1830.5547 299,1830.5547 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M486,1830.5547 C481,1830.5547 481,1851.8516 481,1851.8516 C481,1873.1484 486,1873.1484 486,1873.1484 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="177" x="299" y="1848.5498">'diia-channel-notifications'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="350" y="1864.8467">Kafka Topic</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="168" x="505.5" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="544.5" y="45.1279">Diia Channel</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="512.5" y="61.4248">Notification Subscriber</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="168" x="505.5" y="1830.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="544.5" y="1850.5498">Diia Channel</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="512.5" y="1866.8467">Notification Subscriber</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="144" x="843.5" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="901" y="45.1279">Diia</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="850.5" y="61.4248">Notification Service</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="144" x="843.5" y="1830.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25" x="901" y="1850.5498">Diia</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="850.5" y="1866.8467">Notification Service</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#2688D4;stroke-width:1.5;" width="103" x="997.5" y="41.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="1004.5" y="61.4248">Audit Service</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#2688D4;stroke-width:1.5;" width="103" x="997.5" y="1830.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="1004.5" y="1850.5498">Audit Service</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="187" x="1328" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="1359.5" y="45.1279">Шлюз відправки</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="173" x="1335" y="61.4248">push-нотифікацій в Дію</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="187" x="1328" y="1830.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="1359.5" y="1850.5498">Шлюз відправки</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="173" x="1335" y="1866.8467">push-нотифікацій в Дію</text><path d="M1530,30.1328 L1632,30.1328 C1637,30.1328 1637,51.4297 1637,51.4297 C1637,51.4297 1637,72.7266 1632,72.7266 L1530,72.7266 C1525,72.7266 1525,51.4297 1525,51.4297 C1525,51.4297 1525,30.1328 1530,30.1328 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1632,30.1328 C1627,30.1328 1627,51.4297 1627,51.4297 C1627,72.7266 1632,72.7266 1632,72.7266 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="1530" y="48.1279">'audit-events'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1538.5" y="64.4248">Kafka Topic</text><path d="M1530,1830.5547 L1632,1830.5547 C1637,1830.5547 1637,1851.8516 1637,1851.8516 C1637,1851.8516 1637,1873.1484 1632,1873.1484 L1530,1873.1484 C1525,1873.1484 1525,1851.8516 1525,1851.8516 C1525,1851.8516 1525,1830.5547 1530,1830.5547 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1632,1830.5547 C1627,1830.5547 1627,1851.8516 1627,1851.8516 C1627,1873.1484 1632,1873.1484 1632,1873.1484 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="1530" y="1848.5498">'audit-events'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1538.5" y="1864.8467">Kafka Topic</text><path d="M1652,30.1328 L1870,30.1328 C1875,30.1328 1875,51.4297 1875,51.4297 C1875,51.4297 1875,72.7266 1870,72.7266 L1652,72.7266 C1647,72.7266 1647,51.4297 1647,51.4297 C1647,51.4297 1647,30.1328 1652,30.1328 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1870,30.1328 C1865,30.1328 1865,51.4297 1865,51.4297 C1865,72.7266 1870,72.7266 1870,72.7266 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="208" x="1652" y="48.1279">'diia-channel-notifications.DLT'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1718.5" y="64.4248">Kafka Topic</text><path d="M1652,1830.5547 L1870,1830.5547 C1875,1830.5547 1875,1851.8516 1875,1851.8516 C1875,1851.8516 1875,1873.1484 1870,1873.1484 L1652,1873.1484 C1647,1873.1484 1647,1851.8516 1647,1851.8516 C1647,1851.8516 1647,1830.5547 1652,1830.5547 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1870,1830.5547 C1865,1830.5547 1865,1851.8516 1865,1851.8516 C1865,1873.1484 1870,1873.1484 1870,1873.1484 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="208" x="1652" y="1848.5498">'diia-channel-notifications.DLT'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1718.5" y="1864.8467">Kafka Topic</text><rect fill="#FFFFFF" height="1499.9688" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="584.5" y="321.5859"/><path d="M9,89.7266 L73,89.7266 L73,96.7266 L63,106.7266 L9,106.7266 L9,89.7266 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1724.8281" style="stroke:#000000;stroke-width:2.0;" width="1876" x="9" y="89.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="24" y="102.7935">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="174" x="88" y="101.937">[Відправка повідомлення]</text><path d="M19,113.8594 L96,113.8594 L96,120.8594 L86,130.8594 L19,130.8594 L19,113.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1606.625" style="stroke:#000000;stroke-width:2.0;" width="1661.5" x="19" y="113.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="34" y="126.9263">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="618" x="111" y="126.0698">[Виконання N спроб на відправку згідно налаштувань у разі помилки обробки повідомлення]</text><polygon fill="#2688D4" points="403.5,317.5859,393.5,321.5859,403.5,325.5859,399.5,321.5859" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="397.5" x2="583.5" y1="321.5859" y2="321.5859"/><path d="M29,135.9922 L29,508.9922 L387,508.9922 L387,145.9922 L377,135.9922 L29,135.9922 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M377,135.9922 L377,145.9922 L387,145.9922 L377,135.9922 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="35" y="153.0591">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="43" y="168.1919">"context": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="51" y="183.3247">"system": "Low-code Platform",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="51" y="198.4575">"application": "&lt;bpms.app.name&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="51" y="213.5903">"businessProcess": "&lt;optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="51" y="228.7231">"businessProcessDefinitionId": "&lt;optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="51" y="243.856">"businessProcessInstanceId": "&lt;optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="51" y="258.9888">"businessActivity": "&lt;optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268" x="51" y="274.1216">"businessActivityInstanceId": "&lt;optional&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="43" y="289.2544">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="43" y="304.3872">"notification": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="51" y="319.52">"externalTemplateId": "&lt;external template id&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="43" y="334.6528">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="43" y="349.7856">"recipient": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="321" x="51" y="364.9185">"id": "&lt;Ідентифікатор користувача - optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="51" y="380.0513">"rnokpp": "&lt;ІПН користувача&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="51" y="395.1841">"parameters": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="59" y="410.3169">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="67" y="425.4497">"key": "&lt;key&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="67" y="440.5825">"value": "&lt;value&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="59" y="455.7153">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="51" y="470.8481">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="43" y="485.981">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="35" y="501.1138">}</text><polygon fill="#2688D4" points="903.5,531.3125,913.5,535.3125,903.5,539.3125,907.5,535.3125" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="594.5" x2="909.5" y1="535.3125" y2="535.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="601.5" y="530.2466">Аутентифікація партнера з {Partner Token}</text><polygon fill="#2688D4" points="1409.5,575.5781,1419.5,579.5781,1409.5,583.5781,1413.5,579.5781" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="915.5" x2="1415.5" y1="579.5781" y2="579.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="922.5" y="559.3794">Аутентифікація партнера:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="303" x="922.5" y="574.5122">GET /api/v1/auth/partner/{partnerToken}</text><polygon fill="#2688D4" points="926.5,622.8438,916.5,626.8438,926.5,630.8438,922.5,626.8438" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="920.5" x2="1420.5" y1="626.8438" y2="626.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="932.5" y="621.7778">Токен доступу</text><path d="M1426,592.5781 L1426,647.5781 L1665,647.5781 L1665,602.5781 L1655,592.5781 L1426,592.5781 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M1655,592.5781 L1655,602.5781 L1665,602.5781 L1655,592.5781 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1432" y="609.645">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="1440" y="624.7778">"token": "&lt;authorization token&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1432" y="639.9106">}</text><polygon fill="#2688D4" points="605.5,670.1094,595.5,674.1094,605.5,678.1094,601.5,674.1094" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="599.5" x2="1420.5" y1="674.1094" y2="674.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="611.5" y="669.0435">Токен доступу</text><line style="stroke:#2688D4;stroke-width:1.0;" x1="594.5" x2="636.5" y1="703.2422" y2="703.2422"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="636.5" x2="636.5" y1="703.2422" y2="716.2422"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="595.5" x2="636.5" y1="716.2422" y2="716.2422"/><polygon fill="#2688D4" points="605.5,712.2422,595.5,716.2422,605.5,720.2422,601.5,716.2422" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="601.5" y="698.1763">Обробка результату запиту</text><path d="M284,731.2422 L348,731.2422 L348,738.2422 L338,748.2422 L284,748.2422 L284,731.2422 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="31.1328" style="stroke:#000000;stroke-width:2.0;" width="399.5" x="284" y="731.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="299" y="744.3091">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="228" x="363" y="743.4526">[У разі помилки виконання запиту]</text><polygon fill="#2688D4" points="403.5,750.375,393.5,754.375,403.5,758.375,399.5,754.375" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="397.5" x2="583.5" y1="754.375" y2="754.375"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="594.5" x2="636.5" y1="805.6406" y2="805.6406"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="636.5" x2="636.5" y1="805.6406" y2="818.6406"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="595.5" x2="636.5" y1="818.6406" y2="818.6406"/><polygon fill="#2688D4" points="605.5,814.6406,595.5,818.6406,605.5,822.6406,601.5,818.6406" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="601.5" y="785.4419">Побудова об'єкту повідомлення</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="601.5" y="800.5747">з даних запиту на відправку</text><polygon fill="#2688D4" points="903.5,952.7031,913.5,956.7031,903.5,960.7031,907.5,956.7031" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="594.5" x2="909.5" y1="956.7031" y2="956.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="284" x="601.5" y="951.6372">Відправка повідомлення з {Bearer Token}</text><path d="M250,831.6406 L250,1067.6406 L579,1067.6406 L579,841.6406 L569,831.6406 L250,831.6406 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M569,831.6406 L569,841.6406 L579,841.6406 L569,831.6406 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="256" y="848.7075">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="272" y="863.8403">"templateId": "6132008a2db328003c5d1d43",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="272" y="878.9731">"recipients": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="288" y="894.106">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="304" y="909.2388">"rnokpp": "314...",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="304" y="924.3716">"id": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="304" y="939.5044">"parameters": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="320" y="954.6372">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="336" y="969.77">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="336" y="984.9028">"value": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="320" y="1000.0356">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="304" y="1015.1685">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="288" y="1030.3013">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="272" y="1045.4341">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="256" y="1060.5669">}</text><polygon fill="#2688D4" points="1409.5,1121.0313,1419.5,1125.0313,1409.5,1129.0313,1413.5,1125.0313" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="915.5" x2="1415.5" y1="1125.0313" y2="1125.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="478" x="922.5" y="1089.6997">Реєстрація розсилки push-нотифікацій за заданим шаблоном</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="1404.5" y="1089.6997"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="922.5" y="1104.8325">POST /api/v1/notification/distribution/push</text><ellipse cx="928" cy="1115.5313" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="933.5" y="1119.9653">Authorization: "Bearer &lt;authorization token&gt;"</text><polygon fill="#2688D4" points="926.5,1168.2969,916.5,1172.2969,926.5,1176.2969,922.5,1172.2969" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="920.5" x2="1420.5" y1="1172.2969" y2="1172.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="932.5" y="1167.231">201</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="963.5" y="1167.231">- Ідентифікатор розсилки</text><path d="M1426,1138.0313 L1426,1193.0313 L1653,1193.0313 L1653,1148.0313 L1643,1138.0313 L1426,1138.0313 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M1643,1138.0313 L1643,1148.0313 L1653,1148.0313 L1643,1138.0313 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1432" y="1155.0981">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="1440" y="1170.231">"distributionId": "12345678901"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1432" y="1185.3638">}</text><polygon fill="#2688D4" points="605.5,1215.5625,595.5,1219.5625,605.5,1223.5625,601.5,1219.5625" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="599.5" x2="914.5" y1="1219.5625" y2="1219.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="611.5" y="1214.4966">OK</text><line style="stroke:#2688D4;stroke-width:1.0;" x1="594.5" x2="636.5" y1="1248.6953" y2="1248.6953"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="636.5" x2="636.5" y1="1248.6953" y2="1261.6953"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="595.5" x2="636.5" y1="1261.6953" y2="1261.6953"/><polygon fill="#2688D4" points="605.5,1257.6953,595.5,1261.6953,605.5,1265.6953,601.5,1261.6953" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="601.5" y="1243.6294">Обробка результату запиту</text><path d="M284,1276.6953 L348,1276.6953 L348,1283.6953 L338,1293.6953 L284,1293.6953 L284,1276.6953 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="31.1328" style="stroke:#000000;stroke-width:2.0;" width="399.5" x="284" y="1276.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="299" y="1289.7622">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="228" x="363" y="1288.9058">[У разі помилки виконання запиту]</text><polygon fill="#2688D4" points="403.5,1295.8281,393.5,1299.8281,403.5,1303.8281,399.5,1299.8281" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="397.5" x2="583.5" y1="1299.8281" y2="1299.8281"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="594.5" x2="636.5" y1="1335.9609" y2="1335.9609"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="636.5" x2="636.5" y1="1335.9609" y2="1348.9609"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="595.5" x2="636.5" y1="1348.9609" y2="1348.9609"/><polygon fill="#2688D4" points="605.5,1344.9609,595.5,1348.9609,605.5,1352.9609,601.5,1348.9609" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="601.5" y="1330.895">Формування події аудиту</text><polygon fill="#2688D4" points="1037,1490.5898,1047,1494.5898,1037,1498.5898,1041,1494.5898" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="594.5" x2="1043" y1="1494.5898" y2="1494.5898"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="601.5" y="1489.5239">Фіксація події аудиту</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="193" x="752.5" y="1489.5239">SEND_USER_NOTIFICATION</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="949.5" y="1489.5239">(success)</text><path d="M202,1361.9609 L202,1613.9609 L579,1613.9609 L579,1371.9609 L569,1361.9609 L202,1361.9609 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M569,1361.9609 L569,1371.9609 L579,1371.9609 L569,1361.9609 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="208" y="1379.0278">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="216" y="1394.1606">"notification": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="224" y="1409.2935">"channel:": "diia",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="224" y="1424.4263">"externalTemplateId": "&lt;Ідентифікатор шаблону&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="224" y="1439.5591">"recipient": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="232" y="1454.6919">"id": "&lt;Ідентифікатор користувача&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="232" y="1469.8247">"rnokpp": "&lt;ІПН користувача&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="232" y="1484.9575">"parameters": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="240" y="1500.0903">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="248" y="1515.2231">"key": "&lt;key&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="248" y="1530.356">"value": "&lt;value&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="240" y="1545.4888">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="232" y="1560.6216">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="224" y="1575.7544">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="216" y="1590.8872">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="208" y="1606.02">}</text><polygon fill="#2688D4" points="1569,1636.2188,1579,1640.2188,1569,1644.2188,1573,1640.2188" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1049" x2="1575" y1="1640.2188" y2="1640.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="1056" y="1635.1528">Публікація події аудиту</text><polygon fill="#2688D4" points="1060,1650.2188,1050,1654.2188,1060,1658.2188,1056,1654.2188" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1054" x2="1580" y1="1654.2188" y2="1654.2188"/><polygon fill="#2688D4" points="605.5,1679.3516,595.5,1683.3516,605.5,1687.3516,601.5,1683.3516" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="599.5" x2="1048" y1="1683.3516" y2="1683.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="611.5" y="1678.2856">OK</text><polygon fill="#2688D4" points="403.5,1708.4844,393.5,1712.4844,403.5,1716.4844,399.5,1712.4844" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="397.5" x2="583.5" y1="1712.4844" y2="1712.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="409.5" y="1707.4185">Подію опрацьовано: ACK</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="9" x2="1885" y1="1728.4844" y2="1728.4844"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="210" x="14" y="1738.6948">[Повідомлення не відправлено]</text><polygon fill="#2688D4" points="1749,1759.4219,1759,1763.4219,1749,1767.4219,1753,1763.4219" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="594.5" x2="1755" y1="1763.4219" y2="1763.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="601.5" y="1758.356">Публікації події в Dead Letter Topic</text><polygon fill="#2688D4" points="605.5,1773.4219,595.5,1777.4219,605.5,1781.4219,601.5,1777.4219" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="599.5" x2="1760" y1="1777.4219" y2="1777.4219"/><polygon fill="#2688D4" points="403.5,1802.5547,393.5,1806.5547,403.5,1810.5547,399.5,1806.5547" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="397.5" x2="583.5" y1="1806.5547" y2="1806.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="409.5" y="1801.4888">Подію опрацьовано: ACK</text><!--MD5=[e4f7a8e5e9b0b08146408815c84fc41e]
@startuml
skinparam shadowing false
skinparam DatabaseBackgroundColor white
skinparam DatabaseBorderColor #2688d4
skinparam QueueBackgroundColor white
skinparam QueueBorderColor #2688d4
skinparam NoteBackgroundColor white
skinparam NoteBorderColor #2688d4
skinparam sequence {
    ArrowColor #2688d4
    ActorBorderColor #2688d4
    LifeLineBorderColor #2688d4
    ParticipantBorderColor #2688d4
    ParticipantBackgroundColor white
    BoxBorderColor #2688d4
    BoxBackgroundColor white
}

queue "'diia-channel-notifications'\n Kafka Topic" as diia_notifications_kafka_topic
box "Сервіс нотифікацій користувачів"
  participant "Diia Channel \nNotification Subscriber" as diia_channel_notification_subscriber
  participant "Diia \nNotification Service" as diia_remote_notification_service
  participant "Audit Service" as audit_service
end box
participant "Шлюз відправки \npush-нотифікацій в Дію" as diia_notification_service
queue "'audit-events'\n Kafka Topic" as audit_events_kafka_topic
queue "'diia-channel-notifications.DLT'\n Kafka Topic" as diia_notifications_dlt_kafka_topic

alt Відправка повідомлення
  loop Виконання N спроб на відправку згідно налаштувань у разі помилки обробки повідомлення
  diia_channel_notification_subscriber -> diia_notifications_kafka_topic
  note left
    {
      "context": {
        "system": "Low-code Platform",
        "application": "<bpms.app.name>",
        "businessProcess": "<optional>",
        "businessProcessDefinitionId": "<optional>",
        "businessProcessInstanceId": "<optional>",
        "businessActivity": "<optional>",
        "businessActivityInstanceId": "<optional>"
      },
      "notification": {
        "externalTemplateId": "<external template id>"
      },
      "recipient": {
        "id": "<Ідентифікатор користувача - optional>",
        "rnokpp": "<ІПН користувача>",
        "parameters": [
          {
            "key": "<key>",
            "value": "<value>"
          }
        ]
      }
    }
  end note

  activate diia_channel_notification_subscriber
    diia_channel_notification_subscriber -> diia_remote_notification_service: Аутентифікація партнера з {Partner Token}
    diia_remote_notification_service -> diia_notification_service: Аутентифікація партнера: \n**GET /api/v1/auth/partner/{partnerToken}**
    diia_notification_service - -> diia_remote_notification_service: Токен доступу
    note right
      {
        "token": "<authorization token>"
      }
    end note
    diia_notification_service - -> diia_channel_notification_subscriber: Токен доступу
    diia_channel_notification_subscriber -> diia_channel_notification_subscriber: Обробка результату запиту
    alt У разі помилки виконання запиту
      diia_channel_notification_subscriber - -> diia_notifications_kafka_topic
    end

    diia_channel_notification_subscriber -> diia_channel_notification_subscriber: Побудова об'єкту повідомлення \nз даних запиту на відправку

    diia_channel_notification_subscriber -> diia_remote_notification_service: Відправка повідомлення з {Bearer Token}
    note left
    {
        "templateId": "6132008a2db328003c5d1d43",
        "recipients": [
            {
                "rnokpp": "314...",
                "id": "string",
                "parameters": [
                    {
                        "key": "string",
                        "value": "string"
                    }
                ]
            }
        ]
    }
    end note

    diia_remote_notification_service -> diia_notification_service: **Реєстрація розсилки push-нотифікацій за заданим шаблоном** \nPOST /api/v1/notification/distribution/push \n*Authorization: "Bearer <authorization token>"
    diia_notification_service - -> diia_remote_notification_service: **201** - Ідентифікатор розсилки
    note right
    {
      "distributionId": "12345678901"
    }
    end note

    diia_remote_notification_service - -> diia_channel_notification_subscriber: OK

    diia_channel_notification_subscriber -> diia_channel_notification_subscriber: Обробка результату запиту
    alt У разі помилки виконання запиту
      diia_channel_notification_subscriber - -> diia_notifications_kafka_topic
    end
    diia_channel_notification_subscriber -> diia_channel_notification_subscriber: Формування події аудиту
    diia_channel_notification_subscriber -> audit_service: Фіксація події аудиту **SEND_USER_NOTIFICATION** (success)
    note left
      {
        "notification": {
          "channel:": "diia",
          "externalTemplateId": "<Ідентифікатор шаблону>",
          "recipient": {
            "id": "<Ідентифікатор користувача>",
            "rnokpp": "<ІПН користувача>",
            "parameters": [
              {
                "key": "<key>",
                "value": "<value>"
              }
            ]
          }
        }
      }
    end note
    audit_service -> audit_events_kafka_topic: Публікація події аудиту
    audit_events_kafka_topic - -> audit_service
    audit_service - -> diia_channel_notification_subscriber: OK
    diia_channel_notification_subscriber - -> diia_notifications_kafka_topic: Подію опрацьовано: ACK
  end
else Повідомлення не відправлено
    diia_channel_notification_subscriber -> diia_notifications_dlt_kafka_topic: Публікації події в Dead Letter Topic
    diia_notifications_dlt_kafka_topic - -> diia_channel_notification_subscriber
    diia_channel_notification_subscriber - -> diia_notifications_kafka_topic: Подію опрацьовано: ACK
end
deactivate diia_channel_notification_subscriber
@enduml

PlantUML version 1.2021.7(Sun May 23 12:40:07 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>