<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2230px" preserveAspectRatio="none" style="width:2288px;height:2230px;background:#FFFFFF;" version="1.1" viewBox="0 0 2288 2230" width="2288px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1243.1016" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="331.5" y="146.1563"/><rect fill="#FFFFFF" height="547.7891" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="331.5" y="1564.1875"/><rect fill="#FFFFFF" height="193.0625" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="693.5" y="250.6875"/><rect fill="#FFFFFF" height="820.7109" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="693.5" y="506.1484"/><rect fill="#FFFFFF" height="391.4258" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="693.5" y="1676.2852"/><rect fill="#FFFFFF" height="101.5313" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="1055.5" y="313.0859"/><rect fill="#FFFFFF" height="711.0469" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="1055.5" y="568.5469"/><rect fill="#FFFFFF" height="300.3281" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="1055.5" y="1746.25"/><rect fill="#FFFFFF" height="86.3984" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="1859" y="1433.5234"/><rect fill="#FFFFFF" height="162.7969" style="stroke:#000000;stroke-width:2.0;" width="1653" x="629" y="1876.7813"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="52" x2="52" y1="99.8906" y2="2129.9766"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="336" x2="336" y1="99.8906" y2="2129.9766"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="698" x2="698" y1="99.8906" y2="2129.9766"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1060.5" x2="1060.5" y1="99.8906" y2="2129.9766"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1442.5" x2="1442.5" y1="99.8906" y2="2129.9766"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1628.5" x2="1628.5" y1="99.8906" y2="2129.9766"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1864" x2="1864" y1="99.8906" y2="2129.9766"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2137" x2="2137" y1="99.8906" y2="2129.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="5" y="96.5889">Громадянин</text><ellipse cx="52.5" cy="30.5938" fill="#FEFECE" rx="8" ry="8" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M52.5,38.5938 L52.5,65.5938 M39.5,46.5938 L65.5,46.5938 M52.5,65.5938 L39.5,80.5938 M52.5,65.5938 L65.5,80.5938 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="5" y="2141.9717">Громадянин</text><ellipse cx="52.5" cy="2155.2734" fill="#FEFECE" rx="8" ry="8" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M52.5,2163.2734 L52.5,2190.2734 M39.5,2171.2734 L65.5,2171.2734 M52.5,2190.2734 L39.5,2205.2734 M52.5,2190.2734 L65.5,2205.2734 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="111" x="281" y="52.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="306" y="72.292">Кабінет</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="288" y="88.5889">Громадянина</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="111" x="281" y="2128.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="306" y="2148.9717">Кабінет</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="288" y="2165.2686">Громадянина</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="119" x="639" y="52.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="678.5" y="72.292">Kong</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="646" y="88.5889">Управління API</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="119" x="639" y="2128.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="678.5" y="2148.9717">Kong</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="646" y="2165.2686">Управління API</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="236" x="942.5" y="52.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="993.5" y="72.292">Сервіс управління</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="222" x="949.5" y="88.5889">налаштуваннями користувачів</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="236" x="942.5" y="2128.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="993.5" y="2148.9717">Сервіс управління</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="222" x="949.5" y="2165.2686">налаштуваннями користувачів</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="1420" y="63.9951">Redis</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="1367" y="80.292">in-memory сховище</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202" x="1338.5" y="96.5889">(channel-verification-codes.*)</text><path d="M1424.5,15 C1424.5,5 1442.5,5 1442.5,5 C1442.5,5 1460.5,5 1460.5,15 L1460.5,41 C1460.5,51 1442.5,51 1442.5,51 C1442.5,51 1424.5,51 1424.5,41 L1424.5,15 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.5;"/><path d="M1424.5,15 C1424.5,25 1442.5,25 1442.5,25 C1442.5,25 1460.5,25 1460.5,15 " fill="none" style="stroke:#2688D4;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="1420" y="2141.9717">Redis</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="1367" y="2158.2686">in-memory сховище</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202" x="1338.5" y="2174.5654">(channel-verification-codes.*)</text><path d="M1424.5,2187.8672 C1424.5,2177.8672 1442.5,2177.8672 1442.5,2177.8672 C1442.5,2177.8672 1460.5,2177.8672 1460.5,2187.8672 L1460.5,2213.8672 C1460.5,2223.8672 1442.5,2223.8672 1442.5,2223.8672 C1442.5,2223.8672 1424.5,2223.8672 1424.5,2213.8672 L1424.5,2187.8672 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.5;"/><path d="M1424.5,2187.8672 C1424.5,2197.8672 1442.5,2197.8672 1442.5,2197.8672 C1442.5,2197.8672 1460.5,2197.8672 1460.5,2187.8672 " fill="none" style="stroke:#2688D4;stroke-width:1.5;"/><path d="M1561.5,57.2969 L1696.5,57.2969 C1701.5,57.2969 1701.5,78.5938 1701.5,78.5938 C1701.5,78.5938 1701.5,99.8906 1696.5,99.8906 L1561.5,99.8906 C1556.5,99.8906 1556.5,78.5938 1556.5,78.5938 C1556.5,78.5938 1556.5,57.2969 1561.5,57.2969 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1696.5,57.2969 C1691.5,57.2969 1691.5,78.5938 1691.5,78.5938 C1691.5,99.8906 1696.5,99.8906 1696.5,99.8906 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="1561.5" y="75.292">'user-notifications'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1586.5" y="91.5889">Kafka Topic</text><path d="M1561.5,2128.9766 L1696.5,2128.9766 C1701.5,2128.9766 1701.5,2150.2734 1701.5,2150.2734 C1701.5,2150.2734 1701.5,2171.5703 1696.5,2171.5703 L1561.5,2171.5703 C1556.5,2171.5703 1556.5,2150.2734 1556.5,2150.2734 C1556.5,2150.2734 1556.5,2128.9766 1561.5,2128.9766 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1696.5,2128.9766 C1691.5,2128.9766 1691.5,2150.2734 1691.5,2150.2734 C1691.5,2171.5703 1696.5,2171.5703 1696.5,2171.5703 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="1561.5" y="2146.9717">'user-notifications'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1586.5" y="2163.2686">Kafka Topic</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#2688D4;stroke-width:1.5;" width="256" x="1736" y="68.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="242" x="1743" y="88.5889">Сервіс повідомлень користувачів</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#2688D4;stroke-width:1.5;" width="256" x="1736" y="2128.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="242" x="1743" y="2148.9717">Сервіс повідомлень користувачів</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="264" x="2002" y="96.5889">Сховище налаштувань користувачів</text><path d="M2119,47.5938 C2119,37.5938 2137,37.5938 2137,37.5938 C2137,37.5938 2155,37.5938 2155,47.5938 L2155,73.5938 C2155,83.5938 2137,83.5938 2137,83.5938 C2137,83.5938 2119,83.5938 2119,73.5938 L2119,47.5938 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.5;"/><path d="M2119,47.5938 C2119,57.5938 2137,57.5938 2137,57.5938 C2137,57.5938 2155,57.5938 2155,47.5938 " fill="none" style="stroke:#2688D4;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="264" x="2002" y="2141.9717">Сховище налаштувань користувачів</text><path d="M2119,2155.2734 C2119,2145.2734 2137,2145.2734 2137,2145.2734 C2137,2145.2734 2155,2145.2734 2155,2155.2734 L2155,2181.2734 C2155,2191.2734 2137,2191.2734 2137,2191.2734 C2137,2191.2734 2119,2191.2734 2119,2181.2734 L2119,2155.2734 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.5;"/><path d="M2119,2155.2734 C2119,2165.2734 2137,2165.2734 2137,2165.2734 C2137,2165.2734 2155,2165.2734 2155,2155.2734 " fill="none" style="stroke:#2688D4;stroke-width:1.5;"/><rect fill="#FFFFFF" height="1243.1016" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="331.5" y="146.1563"/><rect fill="#FFFFFF" height="547.7891" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="331.5" y="1564.1875"/><rect fill="#FFFFFF" height="193.0625" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="693.5" y="250.6875"/><rect fill="#FFFFFF" height="820.7109" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="693.5" y="506.1484"/><rect fill="#FFFFFF" height="391.4258" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="693.5" y="1676.2852"/><rect fill="#FFFFFF" height="101.5313" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="1055.5" y="313.0859"/><rect fill="#FFFFFF" height="711.0469" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="1055.5" y="568.5469"/><rect fill="#FFFFFF" height="300.3281" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="1055.5" y="1746.25"/><rect fill="#FFFFFF" height="86.3984" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="1859" y="1433.5234"/><polygon fill="#2688D4" points="319.5,142.1563,329.5,146.1563,319.5,150.1563,323.5,146.1563" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="52.5" x2="325.5" y1="146.1563" y2="146.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="59.5" y="125.9575">Внесення адреси</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="59.5" y="141.0903">для каналу зв'язку</text><line style="stroke:#2688D4;stroke-width:1.0;" x1="341.5" x2="383.5" y1="175.2891" y2="175.2891"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="383.5" x2="383.5" y1="175.2891" y2="188.2891"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="342.5" x2="383.5" y1="188.2891" y2="188.2891"/><polygon fill="#2688D4" points="352.5,184.2891,342.5,188.2891,352.5,192.2891,348.5,188.2891" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="348.5" y="170.2231">Клієнтська валідація адреси</text><polygon fill="#2688D4" points="681.5,246.6875,691.5,250.6875,681.5,254.6875,685.5,250.6875" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="341.5" x2="687.5" y1="250.6875" y2="250.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="328" x="348.5" y="215.356">Запит на валідацію адреси каналу зв'язку</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="680.5" y="215.356"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="348.5" y="230.4888">POST /api/settings/me/{channel}/validate</text><ellipse cx="354" cy="241.1875" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="359.5" y="245.6216">Ідентифікатор сесії Kong</text><path d="M159,201.2891 L159,256.2891 L326,256.2891 L326,211.2891 L316,201.2891 L159,201.2891 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M316,201.2891 L316,211.2891 L326,211.2891 L316,201.2891 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="165" y="218.356">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="181" y="233.4888">"address": "{email}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="165" y="248.6216">}</text><polygon fill="#2688D4" points="1043.5,309.0859,1053.5,313.0859,1043.5,317.0859,1047.5,313.0859" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="703.5" x2="1049.5" y1="313.0859" y2="313.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="328" x="710.5" y="277.7544">Запит на валідацію адреси каналу зв'язку</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="1042.5" y="277.7544"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="710.5" y="292.8872">POST /api/settings/me/{channel}/validate</text><ellipse cx="716" cy="303.5859" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="721.5" y="308.02">X-Access-Token</text><line style="stroke:#2688D4;stroke-width:1.0;" x1="1065.5" x2="1107.5" y1="372.4844" y2="372.4844"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1107.5" x2="1107.5" y1="372.4844" y2="385.4844"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1066.5" x2="1107.5" y1="385.4844" y2="385.4844"/><polygon fill="#2688D4" points="1076.5,381.4844,1066.5,385.4844,1076.5,389.4844,1072.5,385.4844" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="1072.5" y="337.1528">Валідація адреси</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="1072.5" y="352.2856">згідно правил каналу</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="1072.5" y="367.4185">(regexp, blacklist, тощо.)</text><polygon fill="#2688D4" points="714.5,410.6172,704.5,414.6172,714.5,418.6172,710.5,414.6172" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="708.5" x2="1059.5" y1="414.6172" y2="414.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="720.5" y="409.5513">200: Валідацію пройдено</text><polygon fill="#2688D4" points="352.5,439.75,342.5,443.75,352.5,447.75,348.5,443.75" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="346.5" x2="697.5" y1="443.75" y2="443.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="358.5" y="438.6841">200: Валідацію пройдено</text><polygon fill="#2688D4" points="681.5,502.1484,691.5,506.1484,681.5,510.1484,685.5,506.1484" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="341.5" x2="687.5" y1="506.1484" y2="506.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="287" x="348.5" y="470.8169">Запит на верифікацію каналу зв'язку</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="639.5" y="470.8169"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="348.5" y="485.9497">POST /api/settings/me/{channel}/verify</text><ellipse cx="354" cy="496.6484" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="359.5" y="501.0825">Ідентифікатор сесії Kong</text><path d="M151,456.75 L151,511.75 L326,511.75 L326,466.75 L316,456.75 L151,456.75 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M316,456.75 L316,466.75 L326,466.75 L316,456.75 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="157" y="473.8169">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="173" y="488.9497">"address": "${email}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="157" y="504.0825">}</text><polygon fill="#2688D4" points="1043.5,564.5469,1053.5,568.5469,1043.5,572.5469,1047.5,568.5469" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="703.5" x2="1049.5" y1="568.5469" y2="568.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="287" x="710.5" y="533.2153">Запит на верифікацію каналу зв'язку</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="1001.5" y="533.2153"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="710.5" y="548.3481">POST /api/settings/me/{channel}/verify</text><ellipse cx="716" cy="559.0469" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="721.5" y="563.481">X-Access-Token</text><line style="stroke:#2688D4;stroke-width:1.0;" x1="1065.5" x2="1107.5" y1="627.9453" y2="627.9453"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1107.5" x2="1107.5" y1="627.9453" y2="640.9453"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1066.5" x2="1107.5" y1="640.9453" y2="640.9453"/><polygon fill="#2688D4" points="1076.5,636.9453,1066.5,640.9453,1076.5,644.9453,1072.5,640.9453" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="1072.5" y="592.6138">Валідація адреси</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="1072.5" y="607.7466">згідно правил каналу</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="1072.5" y="622.8794">(regexp, blacklist, тощо.)</text><line style="stroke:#2688D4;stroke-width:1.0;" x1="1065.5" x2="1107.5" y1="670.0781" y2="670.0781"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1107.5" x2="1107.5" y1="670.0781" y2="683.0781"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1066.5" x2="1107.5" y1="683.0781" y2="683.0781"/><polygon fill="#2688D4" points="1076.5,679.0781,1066.5,683.0781,1076.5,687.0781,1072.5,683.0781" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="1072.5" y="665.0122">Генерація 6-значного OTP-коду</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="120" x="1289.5" y="665.0122">verificationCode</text><polygon fill="#2688D4" points="1430.5,756.6094,1440.5,760.6094,1430.5,764.6094,1434.5,760.6094" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1065.5" x2="1436.5" y1="760.6094" y2="760.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="1072.5" y="710.145">Збереження запису з ключем</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="342" x="1072.5" y="725.2778">channel-verification-codes:{userId}/{channel}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="1414.5" y="725.2778">*</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="1072.5" y="740.4106">та встановленим TTL згідно конфігурації</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="1072.5" y="755.5435">(перезапис у разі існування)</text><path d="M765,696.0781 L765,766.0781 L1050,766.0781 L1050,706.0781 L1040,696.0781 L765,696.0781 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M1040,696.0781 L1040,706.0781 L1050,706.0781 L1040,696.0781 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="771" y="713.145">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="787" y="728.2778">"address": "{email}",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="787" y="743.4106">"verificationCode": "{verificationCode}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="771" y="758.5435">}</text><polygon fill="#2688D4" points="1076.5,788.7422,1066.5,792.7422,1076.5,796.7422,1072.5,792.7422" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1070.5" x2="1441.5" y1="792.7422" y2="792.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="1082.5" y="787.6763">OK</text><polygon fill="#2688D4" points="1617,1025.168,1627,1029.168,1617,1033.168,1621,1029.168" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1065.5" x2="1623" y1="1029.168" y2="1029.168"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="1072.5" y="1008.9692">Публікація запиту на</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="1072.5" y="1024.1021">відправлення повідомлення з OTP-кодом</text><path d="M749,805.7422 L749,1223.7422 L1050,1223.7422 L1050,815.7422 L1040,805.7422 L749,805.7422 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M1040,805.7422 L1040,815.7422 L1050,815.7422 L1040,805.7422 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="755" y="822.8091">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="763" y="837.9419">"context": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="771" y="853.0747">"system": "Low-code Platform",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="771" y="868.2075">"application": "user-settings-service",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="763" y="883.3403">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="763" y="898.4731">"notification": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="771" y="913.606">"templateName": "channel-confirmation",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="771" y="928.7388">"ignoreChannelPreferences": true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="763" y="943.8716">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="763" y="959.0044">"recipients": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="771" y="974.1372">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="783" y="989.27">"id": "{userId}",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="783" y="1004.4028">"channels": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="791" y="1019.5356">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="799" y="1034.6685">"channel": "email",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="799" y="1049.8013">"email": "{email}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="791" y="1064.9341">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="783" y="1080.0669">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="783" y="1095.1997">"parameters": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="791" y="1110.3325">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="807" y="1125.4653">"key": "verificationCode",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="807" y="1140.5981">"value": "{verificationCode}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="791" y="1155.731">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="783" y="1170.8638">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="771" y="1185.9966">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="763" y="1201.1294">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="755" y="1216.2622">}</text><polygon fill="#2688D4" points="1076.5,1246.4609,1066.5,1250.4609,1076.5,1254.4609,1072.5,1250.4609" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1070.5" x2="1628" y1="1250.4609" y2="1250.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="1082.5" y="1245.395">Запит опубліковано</text><polygon fill="#2688D4" points="714.5,1275.5938,704.5,1279.5938,714.5,1283.5938,710.5,1279.5938" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="708.5" x2="1059.5" y1="1279.5938" y2="1279.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="720.5" y="1274.5278">202 - Accepted</text><polygon fill="#2688D4" points="352.5,1322.8594,342.5,1326.8594,352.5,1330.8594,348.5,1326.8594" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="346.5" x2="697.5" y1="1326.8594" y2="1326.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="358.5" y="1321.7935">202 - Accepted</text><path d="M708,1292.5938 L708,1347.5938 L978,1347.5938 L978,1302.5938 L968,1292.5938 L708,1292.5938 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M968,1292.5938 L968,1302.5938 L978,1302.5938 L968,1292.5938 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="714" y="1309.6606">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="730" y="1324.7935">"verificationCodeExpirationSec": "60"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="714" y="1339.9263">}</text><polygon fill="#2688D4" points="63.5,1385.2578,53.5,1389.2578,63.5,1393.2578,59.5,1389.2578" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="57.5" x2="335.5" y1="1389.2578" y2="1389.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="69.5" y="1369.0591">Очікування на внесення</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="69.5" y="1384.1919">OTP-коду з повідомлення</text><polygon fill="#2688D4" points="1640,1429.5234,1630,1433.5234,1640,1437.5234,1636,1433.5234" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1634" x2="1858" y1="1433.5234" y2="1433.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="1646" y="1413.3247">Отримання запиту</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="1646" y="1428.4575">на відправлення повідомлення</text><line style="stroke:#2688D4;stroke-width:1.0;" x1="1869" x2="1911" y1="1477.7891" y2="1477.7891"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1911" x2="1911" y1="1477.7891" y2="1490.7891"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1870" x2="1911" y1="1490.7891" y2="1490.7891"/><polygon fill="#2688D4" points="1880,1486.7891,1870,1490.7891,1880,1494.7891,1876,1490.7891" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="1876" y="1457.5903">Обробка запиту</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="1876" y="1472.7231">на відправлення повідомлення</text><polygon fill="#2688D4" points="63.5,1515.9219,53.5,1519.9219,63.5,1523.9219,59.5,1519.9219" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="57.5" x2="1863" y1="1519.9219" y2="1519.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="69.5" y="1514.856">Відправлення повідомлення з OTP-кодом</text><polygon fill="#2688D4" points="319.5,1560.1875,329.5,1564.1875,319.5,1568.1875,323.5,1564.1875" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="52.5" x2="325.5" y1="1564.1875" y2="1564.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="59.5" y="1543.9888">Активація адреси для каналу зв'язку</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="59.5" y="1559.1216">з внесенням OTP-коду</text><line style="stroke:#2688D4;stroke-width:1.0;" x1="341.5" x2="383.5" y1="1593.3203" y2="1593.3203"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="383.5" x2="383.5" y1="1593.3203" y2="1606.3203"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="342.5" x2="383.5" y1="1606.3203" y2="1606.3203"/><polygon fill="#2688D4" points="352.5,1602.3203,342.5,1606.3203,352.5,1610.3203,348.5,1606.3203" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="348.5" y="1588.2544">Клієнтська валідація OTP-коду та адреси</text><polygon fill="#2688D4" points="681.5,1672.2852,691.5,1676.2852,681.5,1680.2852,685.5,1676.2852" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="341.5" x2="687.5" y1="1676.2852" y2="1676.2852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="329" x="348.5" y="1640.9536">Запит на активацію адреси каналу зв'язку</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="681.5" y="1640.9536"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="348.5" y="1656.0864">POST /api/settings/me/{channel}/activate</text><ellipse cx="354" cy="1666.7852" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="359.5" y="1671.2192">Ідентифікатор сесії Kong</text><path d="M41,1619.3203 L41,1689.3203 L326,1689.3203 L326,1629.3203 L316,1619.3203 L41,1619.3203 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M316,1619.3203 L316,1629.3203 L326,1629.3203 L316,1619.3203 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="47" y="1636.3872">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="63" y="1651.52">"address": "{email}",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="63" y="1666.6528">"verificationCode": "{verificationCode}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="47" y="1681.7856">}</text><polygon fill="#2688D4" points="1043.5,1742.25,1053.5,1746.25,1043.5,1750.25,1047.5,1746.25" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="703.5" x2="1049.5" y1="1746.25" y2="1746.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="329" x="710.5" y="1710.9185">Запит на активацію адреси каналу зв'язку</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="1043.5" y="1710.9185"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="710.5" y="1726.0513">POST /api/settings/me/{channel}/activate</text><ellipse cx="716" cy="1736.75" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="721.5" y="1741.1841">X-Access-Token</text><polygon fill="#2688D4" points="1430.5,1786.5156,1440.5,1790.5156,1430.5,1794.5156,1434.5,1790.5156" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1065.5" x2="1436.5" y1="1790.5156" y2="1790.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="1072.5" y="1770.3169">Отримання запису за ключем</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="342" x="1072.5" y="1785.4497">channel-verification-codes:{userId}/{channel}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="1414.5" y="1785.4497">*</text><polygon fill="#2688D4" points="1076.5,1815.6484,1066.5,1819.6484,1076.5,1823.6484,1072.5,1819.6484" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1070.5" x2="1441.5" y1="1819.6484" y2="1819.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="1082.5" y="1814.5825">Запис з OTP-кодом</text><line style="stroke:#2688D4;stroke-width:1.0;" x1="1065.5" x2="1107.5" y1="1848.7813" y2="1848.7813"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1107.5" x2="1107.5" y1="1848.7813" y2="1861.7813"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1066.5" x2="1107.5" y1="1861.7813" y2="1861.7813"/><polygon fill="#2688D4" points="1076.5,1857.7813,1066.5,1861.7813,1076.5,1865.7813,1072.5,1861.7813" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="1072.5" y="1843.7153">Перевірка співпадіння адреси та OTP-коду</text><path d="M629,1876.7813 L693,1876.7813 L693,1883.7813 L683,1893.7813 L629,1893.7813 L629,1876.7813 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="162.7969" style="stroke:#000000;stroke-width:2.0;" width="1653" x="629" y="1876.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="644" y="1889.8481">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="288" x="708" y="1888.9917">[Адресу та OTP-код верифіковано успішно]</text><polygon fill="#2688D4" points="1430.5,1926.1797,1440.5,1930.1797,1430.5,1934.1797,1434.5,1930.1797" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1065.5" x2="1436.5" y1="1930.1797" y2="1930.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="1072.5" y="1909.981">Видалення запису з OTP-кодом за ключем</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="342" x="1072.5" y="1925.1138">channel-verification-codes:{userId}/{channel}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="1414.5" y="1925.1138">*</text><polygon fill="#2688D4" points="1076.5,1955.3125,1066.5,1959.3125,1076.5,1963.3125,1072.5,1959.3125" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1070.5" x2="1441.5" y1="1959.3125" y2="1959.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="1082.5" y="1954.2466">OK</text><polygon fill="#2688D4" points="2125,1984.4453,2135,1988.4453,2125,1992.4453,2129,1988.4453" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1065.5" x2="2131" y1="1988.4453" y2="1988.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335" x="1072.5" y="1983.3794">Збереження адреси та активація каналу зв'язку</text><polygon fill="#2688D4" points="1076.5,1998.4453,1066.5,2002.4453,1076.5,2006.4453,1072.5,2002.4453" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1070.5" x2="2136" y1="2002.4453" y2="2002.4453"/><polygon fill="#2688D4" points="714.5,2027.5781,704.5,2031.5781,714.5,2035.5781,710.5,2031.5781" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="708.5" x2="1054.5" y1="2031.5781" y2="2031.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="720.5" y="2026.5122">200 - OK</text><polygon fill="#2688D4" points="352.5,2063.7109,342.5,2067.7109,352.5,2071.7109,348.5,2067.7109" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="346.5" x2="697.5" y1="2067.7109" y2="2067.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="358.5" y="2062.645">200 - OK</text><polygon fill="#2688D4" points="63.5,2107.9766,53.5,2111.9766,63.5,2115.9766,59.5,2111.9766" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="57.5" x2="335.5" y1="2111.9766" y2="2111.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="69.5" y="2091.7778">Канал успішно активовано</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="69.5" y="2106.9106">з новою адресою</text><!--MD5=[70c0b1a31fc9f8e7015d5891956c7ca7]
@startuml
skinparam shadowing false
skinparam DatabaseBackgroundColor white
skinparam DatabaseBorderColor #2688d4
skinparam QueueBackgroundColor white
skinparam QueueBorderColor #2688d4
skinparam NoteBackgroundColor white
skinparam NoteBorderColor #2688d4
skinparam sequence {
    ArrowColor #2688d4
    ActorBorderColor #2688d4
    LifeLineBorderColor #2688d4
    ParticipantBorderColor #2688d4
    ParticipantBackgroundColor white
    BoxBorderColor #2688d4
    BoxBackgroundColor white
}

actor Громадянин as citizen
participant "Кабінет \nГромадянина" as citizen_portal
participant "Kong \nУправління API" as kong
participant "Сервіс управління \nналаштуваннями користувачів" as user_settings_service
database "Redis\nin-memory сховище \n(channel-verification-codes.*)" as redis
queue "'user-notifications'\n Kafka Topic" as user_notifications_topic
participant "Сервіс повідомлень користувачів" as user_notifications_service
database "Сховище налаштувань користувачів" as user_settings_database

citizen -> citizen_portal: Внесення адреси \nдля каналу зв'язку
activate citizen_portal
  citizen_portal -> citizen_portal: Клієнтська валідація адреси
  citizen_portal -> kong: **Запит на валідацію адреси каналу зв'язку** \nPOST /api/settings/me/{channel}/validate \n*Ідентифікатор сесії Kong
  note left
    {
        "address": "{email}"
    }
  end note
  activate kong
    kong -> user_settings_service: **Запит на валідацію адреси каналу зв'язку** \nPOST /api/settings/me/{channel}/validate \n*X-Access-Token
    activate user_settings_service
      user_settings_service -> user_settings_service: Валідація адреси \nзгідно правил каналу \n(regexp, blacklist, тощо.)
      user_settings_service - -> kong: 200: Валідацію пройдено
    deactivate user_settings_service
    kong - -> citizen_portal: 200: Валідацію пройдено
  deactivate kong
  citizen_portal -> kong: **Запит на верифікацію каналу зв'язку** \nPOST /api/settings/me/{channel}/verify \n*Ідентифікатор сесії Kong
  note left
    {
        "address": "${email}"
    }
  end note
  activate kong
    kong -> user_settings_service: **Запит на верифікацію каналу зв'язку** \nPOST /api/settings/me/{channel}/verify \n*X-Access-Token
    activate user_settings_service
      user_settings_service -> user_settings_service: Валідація адреси \nзгідно правил каналу \n(regexp, blacklist, тощо.)
      user_settings_service -> user_settings_service: Генерація 6-значного OTP-коду **verificationCode**
      user_settings_service -> redis: Збереження запису з ключем \n**channel-verification-codes:{userId}/{channel}*** \nта встановленим TTL згідно конфігурації \n(перезапис у разі існування)
      note left
        {
            "address": "{email}",
            "verificationCode": "{verificationCode}"
        }
      end note
      redis - -> user_settings_service: OK
      user_settings_service -> user_notifications_topic: Публікація запиту на \nвідправлення повідомлення з OTP-кодом
      note left
       {
         "context": {
           "system": "Low-code Platform",
           "application": "user-settings-service",
         },
         "notification": {
           "templateName": "channel-confirmation",
           "ignoreChannelPreferences": true
         },
         "recipients": [
           {
              "id": "{userId}",
              "channels": [
                {
                  "channel": "email",
                  "email": "{email}"
                }
              ],
              "parameters": [
                {
                    "key": "verificationCode",
                    "value": "{verificationCode}"
                }
              ]
           }
         ]
       }
      end note
      user_notifications_topic - -> user_settings_service: Запит опубліковано
      user_settings_service - -> kong: 202 - Accepted
    deactivate user_settings_service
    kong - -> citizen_portal: 202 - Accepted
    note right
      {
          "verificationCodeExpirationSec": "60"
      }
    end note
  deactivate kong
  citizen_portal - -> citizen: Очікування на внесення \nOTP-коду з повідомлення
deactivate citizen_portal

user_notifications_service -> user_notifications_topic: Отримання запиту \nна відправлення повідомлення
activate user_notifications_service
  user_notifications_service -> user_notifications_service: Обробка запиту \nна відправлення повідомлення
  user_notifications_service - -> citizen: Відправлення повідомлення з OTP-кодом
deactivate user_notifications_service

citizen -> citizen_portal: Активація адреси для каналу зв'язку \nз внесенням OTP-коду
activate citizen_portal
  citizen_portal -> citizen_portal: Клієнтська валідація OTP-коду та адреси
  citizen_portal -> kong: **Запит на активацію адреси каналу зв'язку** \nPOST /api/settings/me/{channel}/activate \n*Ідентифікатор сесії Kong
  note left
    {
        "address": "{email}",
        "verificationCode": "{verificationCode}"
    }
  end note
  activate kong
    kong -> user_settings_service: **Запит на активацію адреси каналу зв'язку** \nPOST /api/settings/me/{channel}/activate \n*X-Access-Token
    activate user_settings_service
      user_settings_service -> redis: Отримання запису за ключем \n**channel-verification-codes:{userId}/{channel}***
      redis - -> user_settings_service: Запис з OTP-кодом
      user_settings_service -> user_settings_service: Перевірка співпадіння адреси та OTP-коду
      alt Адресу та OTP-код верифіковано успішно
        user_settings_service -> redis: Видалення запису з OTP-кодом за ключем\n**channel-verification-codes:{userId}/{channel}***
        redis - -> user_settings_service: OK
        user_settings_service -> user_settings_database: Збереження адреси та активація каналу зв'язку
        user_settings_database - -> user_settings_service
        user_settings_service - -> kong: 200 - OK
      end
    deactivate user_settings_service
    kong - -> citizen_portal: 200 - OK
  deactivate kong
  citizen_portal - -> citizen: Канал успішно активовано \nз новою адресою
deactivate citizen_portal
@enduml

PlantUML version 1.2021.7(Sun May 23 12:40:07 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>