<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1109px" preserveAspectRatio="none" style="width:1712px;height:1109px;background:#FFFFFF;" version="1.1" viewBox="0 0 1712 1109" width="1712px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1097.2734" style="stroke:#2688D4;stroke-width:1.0;" width="546.5" x="481" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="233" x="637.75" y="18.0669">Сервіс відправки повідомлень</text><rect fill="#FFFFFF" height="744.2227" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="529" y="283.7539"/><rect fill="#FFFFFF" height="931.25" style="stroke:#000000;stroke-width:2.0;" width="1696" x="9" y="89.7266"/><rect fill="#FFFFFF" height="513.3203" style="stroke:#000000;stroke-width:2.0;" width="1676" x="19" y="113.8594"/><rect fill="#FFFFFF" height="31.1328" style="stroke:#000000;stroke-width:2.0;" width="339" x="254" y="589.0469"/><rect fill="#FFFFFF" height="87.0703" style="stroke:none;stroke-width:1.0;" width="1696" x="9" y="933.9063"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="369" x2="369" y1="72.7266" y2="1037.9766"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="534" x2="534" y1="72.7266" y2="1037.9766"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="789.5" x2="789.5" y1="72.7266" y2="1037.9766"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="971.5" x2="971.5" y1="72.7266" y2="1037.9766"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1157" x2="1157" y1="72.7266" y2="1037.9766"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1344" x2="1344" y1="72.7266" y2="1037.9766"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1580" x2="1580" y1="72.7266" y2="1037.9766"/><path d="M269,30.1328 L470,30.1328 C475,30.1328 475,51.4297 475,51.4297 C475,51.4297 475,72.7266 470,72.7266 L269,72.7266 C264,72.7266 264,51.4297 264,51.4297 C264,51.4297 264,30.1328 269,30.1328 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M470,30.1328 C465,30.1328 465,51.4297 465,51.4297 C465,72.7266 470,72.7266 470,72.7266 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="191" x="269" y="48.1279">'inbox-notifications-channel'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="327" y="64.4248">Kafka Topic</text><path d="M269,1036.9766 L470,1036.9766 C475,1036.9766 475,1058.2734 475,1058.2734 C475,1058.2734 475,1079.5703 470,1079.5703 L269,1079.5703 C264,1079.5703 264,1058.2734 264,1058.2734 C264,1058.2734 264,1036.9766 269,1036.9766 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M470,1036.9766 C465,1036.9766 465,1058.2734 465,1058.2734 C465,1079.5703 470,1079.5703 470,1079.5703 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="191" x="269" y="1054.9717">'inbox-notifications-channel'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="327" y="1071.2686">Kafka Topic</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="98" x="485" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="492" y="45.1279">Inbox Event</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="497" y="61.4248">Subscriber</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="98" x="485" y="1036.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="492" y="1056.9717">Inbox Event</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="497" y="1073.2686">Subscriber</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="135" x="722.5" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="729.5" y="45.1279">Inbox Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="765" y="61.4248">Service</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="135" x="722.5" y="1036.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="729.5" y="1056.9717">Inbox Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="50" x="765" y="1073.2686">Service</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#2688D4;stroke-width:1.5;" width="103" x="920.5" y="41.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="927.5" y="61.4248">Audit Service</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#2688D4;stroke-width:1.5;" width="103" x="920.5" y="1036.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="927.5" y="1056.9717">Audit Service</text><path d="M1106,30.1328 L1208,30.1328 C1213,30.1328 1213,51.4297 1213,51.4297 C1213,51.4297 1213,72.7266 1208,72.7266 L1106,72.7266 C1101,72.7266 1101,51.4297 1101,51.4297 C1101,51.4297 1101,30.1328 1106,30.1328 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1208,30.1328 C1203,30.1328 1203,51.4297 1203,51.4297 C1203,72.7266 1208,72.7266 1208,72.7266 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="1106" y="48.1279">'audit-events'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1114.5" y="64.4248">Kafka Topic</text><path d="M1106,1036.9766 L1208,1036.9766 C1213,1036.9766 1213,1058.2734 1213,1058.2734 C1213,1058.2734 1213,1079.5703 1208,1079.5703 L1106,1079.5703 C1101,1079.5703 1101,1058.2734 1101,1058.2734 C1101,1058.2734 1101,1036.9766 1106,1036.9766 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1208,1036.9766 C1203,1036.9766 1203,1058.2734 1203,1058.2734 C1203,1079.5703 1208,1079.5703 1208,1079.5703 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="1106" y="1054.9717">'audit-events'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1114.5" y="1071.2686">Kafka Topic</text><path d="M1228,30.1328 L1460,30.1328 C1465,30.1328 1465,51.4297 1465,51.4297 C1465,51.4297 1465,72.7266 1460,72.7266 L1228,72.7266 C1223,72.7266 1223,51.4297 1223,51.4297 C1223,51.4297 1223,30.1328 1228,30.1328 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1460,30.1328 C1455,30.1328 1455,51.4297 1455,51.4297 C1455,72.7266 1460,72.7266 1460,72.7266 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="222" x="1228" y="48.1279">'inbox-notifications-channel.DLT'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1301.5" y="64.4248">Kafka Topic</text><path d="M1228,1036.9766 L1460,1036.9766 C1465,1036.9766 1465,1058.2734 1465,1058.2734 C1465,1058.2734 1465,1079.5703 1460,1079.5703 L1228,1079.5703 C1223,1079.5703 1223,1058.2734 1223,1058.2734 C1223,1058.2734 1223,1036.9766 1228,1036.9766 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1460,1036.9766 C1455,1036.9766 1455,1058.2734 1455,1058.2734 C1455,1079.5703 1460,1079.5703 1460,1079.5703 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="222" x="1228" y="1054.9717">'inbox-notifications-channel.DLT'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1301.5" y="1071.2686">Kafka Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204" x="1475" y="69.4248">Сховище inbox повідомлень</text><path d="M1562,20.4297 C1562,10.4297 1580,10.4297 1580,10.4297 C1580,10.4297 1598,10.4297 1598,20.4297 L1598,46.4297 C1598,56.4297 1580,56.4297 1580,56.4297 C1580,56.4297 1562,56.4297 1562,46.4297 L1562,20.4297 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.5;"/><path d="M1562,20.4297 C1562,30.4297 1580,30.4297 1580,30.4297 C1580,30.4297 1598,30.4297 1598,20.4297 " fill="none" style="stroke:#2688D4;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204" x="1475" y="1049.9717">Сховище inbox повідомлень</text><path d="M1562,1063.2734 C1562,1053.2734 1580,1053.2734 1580,1053.2734 C1580,1053.2734 1598,1053.2734 1598,1063.2734 L1598,1089.2734 C1598,1099.2734 1580,1099.2734 1580,1099.2734 C1580,1099.2734 1562,1099.2734 1562,1089.2734 L1562,1063.2734 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.5;"/><path d="M1562,1063.2734 C1562,1073.2734 1580,1073.2734 1580,1073.2734 C1580,1073.2734 1598,1073.2734 1598,1063.2734 " fill="none" style="stroke:#2688D4;stroke-width:1.5;"/><rect fill="#FFFFFF" height="744.2227" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="529" y="283.7539"/><path d="M9,89.7266 L73,89.7266 L73,96.7266 L63,106.7266 L9,106.7266 L9,89.7266 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="931.25" style="stroke:#000000;stroke-width:2.0;" width="1696" x="9" y="89.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="24" y="102.7935">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="270" x="88" y="101.937">[Відправка повідомлення (вдалий кейс)]</text><path d="M19,113.8594 L96,113.8594 L96,120.8594 L86,130.8594 L19,130.8594 L19,113.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="513.3203" style="stroke:#000000;stroke-width:2.0;" width="1676" x="19" y="113.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="34" y="126.9263">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="618" x="111" y="126.0698">[Виконання N спроб на відправку згідно налаштувань у разі помилки обробки повідомлення]</text><polygon fill="#2688D4" points="380.5,279.7539,370.5,283.7539,380.5,287.7539,376.5,283.7539" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="374.5" x2="528" y1="283.7539" y2="283.7539"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="386.5" y="278.688">Зчитування події</text><path d="M29,135.9922 L29,417.9922 L364,417.9922 L364,145.9922 L354,135.9922 L29,135.9922 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M354,135.9922 L354,145.9922 L364,145.9922 L354,135.9922 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="35" y="153.0591">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="43" y="168.1919">"context": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="51" y="183.3247">"system": "Low-code Platform",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="51" y="198.4575">"application": "&lt;bpms.app.name&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="51" y="213.5903">"businessProcess": "&lt;optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="51" y="228.7231">"businessProcessDefinitionId": "&lt;optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="51" y="243.856">"businessProcessInstanceId": "&lt;optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="51" y="258.9888">"businessActivity": "&lt;optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268" x="51" y="274.1216">"businessActivityInstanceId": "&lt;optional&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="43" y="289.2544">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="43" y="304.3872">"notification": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="51" y="319.52">"subject": "&lt;notification subject&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="51" y="334.6528">"message": "&lt;notification message&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="43" y="349.7856">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="43" y="364.9185">"recipient": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298" x="51" y="380.0513">"id": "Ідентифікатор користувача в системі"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="43" y="395.1841">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="35" y="410.3169">}</text><line style="stroke:#2688D4;stroke-width:1.0;" x1="539" x2="581" y1="459.6484" y2="459.6484"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="581" x2="581" y1="459.6484" y2="472.6484"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="540" x2="581" y1="472.6484" y2="472.6484"/><polygon fill="#2688D4" points="550,468.6484,540,472.6484,550,476.6484,546,472.6484" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="546" y="439.4497">Підготовка повідомлення</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="546" y="454.5825">до збереження в БД</text><polygon fill="#2688D4" points="778,497.7813,788,501.7813,778,505.7813,782,501.7813" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="539" x2="784" y1="501.7813" y2="501.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="546" y="496.7153">Збереження in-app повідомлення</text><polygon fill="#2688D4" points="1568,526.9141,1578,530.9141,1568,534.9141,1572,530.9141" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="790" x2="1574" y1="530.9141" y2="530.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="797" y="525.8481">Збереження повідомлення до БД</text><polygon fill="#2688D4" points="801,556.0469,791,560.0469,801,564.0469,797,560.0469" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="795" x2="1579" y1="560.0469" y2="560.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="807" y="554.981">Результат збереження</text><polygon fill="#2688D4" points="550,570.0469,540,574.0469,550,578.0469,546,574.0469" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="544" x2="789" y1="574.0469" y2="574.0469"/><path d="M254,589.0469 L318,589.0469 L318,596.0469 L308,606.0469 L254,606.0469 L254,589.0469 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="31.1328" style="stroke:#000000;stroke-width:2.0;" width="339" x="254" y="589.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="269" y="602.1138">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="176" x="333" y="601.2573">[Помилка при збереженні]</text><polygon fill="#2688D4" points="380.5,608.1797,370.5,612.1797,380.5,616.1797,376.5,612.1797" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="374.5" x2="528" y1="612.1797" y2="612.1797"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="539" x2="581" y1="655.3125" y2="655.3125"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="581" x2="581" y1="655.3125" y2="668.3125"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="540" x2="581" y1="668.3125" y2="668.3125"/><polygon fill="#2688D4" points="550,664.3125,540,668.3125,550,672.3125,546,668.3125" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="546" y="650.2466">Формування події аудиту</text><polygon fill="#2688D4" points="960,764.543,970,768.543,960,772.543,964,768.543" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="539" x2="966" y1="768.543" y2="768.543"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="546" y="763.4771">Фіксація події аудиту</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="193" x="697" y="763.4771">SEND_USER_NOTIFICATION</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="894" y="763.4771">(success)</text><path d="M217,681.3125 L217,842.3125 L524,842.3125 L524,691.3125 L514,681.3125 L217,681.3125 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M514,681.3125 L514,691.3125 L524,691.3125 L514,681.3125 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="223" y="698.3794">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="231" y="713.5122">"notification": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="239" y="728.645">"channel:": "inbox",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="239" y="743.7778">"subject": "&lt;Заголовок повідомлення&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="239" y="758.9106">"message": "&lt;Повідомлення&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="239" y="774.0435">"recipient": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="247" y="789.1763">"id": "&lt;Ідентифікатор користувача&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="239" y="804.3091">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="231" y="819.4419">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="223" y="834.5747">}</text><polygon fill="#2688D4" points="1145,864.7734,1155,868.7734,1145,872.7734,1149,868.7734" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="972" x2="1151" y1="868.7734" y2="868.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="979" y="863.7075">Публікація події аудиту</text><polygon fill="#2688D4" points="983,878.7734,973,882.7734,983,886.7734,979,882.7734" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="977" x2="1156" y1="882.7734" y2="882.7734"/><polygon fill="#2688D4" points="550,892.7734,540,896.7734,550,900.7734,546,896.7734" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="544" x2="971" y1="896.7734" y2="896.7734"/><polygon fill="#2688D4" points="380.5,921.9063,370.5,925.9063,380.5,929.9063,376.5,925.9063" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="374.5" x2="528" y1="925.9063" y2="925.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="386.5" y="920.8403">Подію опрацьовано</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="9" x2="1705" y1="934.9063" y2="934.9063"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="210" x="14" y="945.1167">[Повідомлення не відправлено]</text><polygon fill="#2688D4" points="1332,965.8438,1342,969.8438,1332,973.8438,1336,969.8438" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="539" x2="1338" y1="969.8438" y2="969.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="546" y="964.7778">Публікації події в Dead Letter Topic</text><polygon fill="#2688D4" points="550,979.8438,540,983.8438,550,987.8438,546,983.8438" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="544" x2="1343" y1="983.8438" y2="983.8438"/><polygon fill="#2688D4" points="380.5,1008.9766,370.5,1012.9766,380.5,1016.9766,376.5,1012.9766" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="374.5" x2="528" y1="1012.9766" y2="1012.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="386.5" y="1007.9106">Подію опрацьовано</text><!--MD5=[5a72c63f3ed257d1095fc5a89c306df8]
@startuml
skinparam shadowing false
skinparam DatabaseBackgroundColor white
skinparam DatabaseBorderColor #2688d4
skinparam QueueBackgroundColor white
skinparam QueueBorderColor #2688d4
skinparam NoteBackgroundColor white
skinparam NoteBorderColor #2688d4
skinparam sequence {
    ArrowColor #2688d4
    ActorBorderColor #2688d4
    LifeLineBorderColor #2688d4
    ParticipantBorderColor #2688d4
    ParticipantBackgroundColor white
    BoxBorderColor #2688d4
    BoxBackgroundColor white
}

queue "'inbox-notifications-channel'\n Kafka Topic" as inbox_notifications_channel_kafka_topic

box "Сервіс відправки повідомлень"
  participant "Inbox Event \nSubscriber" as notification_kafka_subscriber
  participant "Inbox Notification \nService" as inbox_notification_service
  participant "Audit Service" as audit_service
end box

queue "'audit-events'\n Kafka Topic" as audit_events_kafka_topic

queue "'inbox-notifications-channel.DLT'\n Kafka Topic" as inbox_notifications_channel_dlt_kafka_topic

database "Сховище inbox повідомлень" as inbox_db

alt Відправка повідомлення (вдалий кейс)
loop Виконання N спроб на відправку згідно налаштувань у разі помилки обробки повідомлення
notification_kafka_subscriber -> inbox_notifications_channel_kafka_topic: Зчитування події
note left
  {
    "context": {
      "system": "Low-code Platform",
      "application": "<bpms.app.name>",
      "businessProcess": "<optional>",
      "businessProcessDefinitionId": "<optional>",
      "businessProcessInstanceId": "<optional>",
      "businessActivity": "<optional>",
      "businessActivityInstanceId": "<optional>"
    },
    "notification": {
      "subject": "<notification subject>",
      "message": "<notification message>"
    },
    "recipient": {
      "id": "Ідентифікатор користувача в системі"
    }
  }
  end note
activate notification_kafka_subscriber
notification_kafka_subscriber -> notification_kafka_subscriber: Підготовка повідомлення \nдо збереження в БД
notification_kafka_subscriber -> inbox_notification_service: Збереження in-app повідомлення
inbox_notification_service -> inbox_db: Збереження повідомлення до БД
inbox_db - -> inbox_notification_service: Результат збереження
inbox_notification_service - -> notification_kafka_subscriber
  alt Помилка при збереженні
    notification_kafka_subscriber - -> inbox_notifications_channel_kafka_topic
  end
end
    notification_kafka_subscriber -> notification_kafka_subscriber: Формування події аудиту
    notification_kafka_subscriber -> audit_service: Фіксація події аудиту **SEND_USER_NOTIFICATION** (success)
    note left
    {
      "notification": {
        "channel:": "inbox",
        "subject": "<Заголовок повідомлення>",
        "message": "<Повідомлення>",
        "recipient": {
          "id": "<Ідентифікатор користувача>"
        }
      }
    }
    end note
    audit_service -> audit_events_kafka_topic: Публікація події аудиту
    audit_events_kafka_topic - -> audit_service
    audit_service - -> notification_kafka_subscriber
    notification_kafka_subscriber - -> inbox_notifications_channel_kafka_topic: Подію опрацьовано

else Повідомлення не відправлено
    notification_kafka_subscriber -> inbox_notifications_channel_dlt_kafka_topic: Публікації події в Dead Letter Topic
    inbox_notifications_channel_dlt_kafka_topic - -> notification_kafka_subscriber
    notification_kafka_subscriber - -> inbox_notifications_channel_kafka_topic: Подію опрацьовано
end
deactivate notification_kafka_subscriber
@enduml

PlantUML version 1.2021.7(Sun May 23 12:40:07 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>