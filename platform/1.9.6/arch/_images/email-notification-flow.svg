<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1190px" preserveAspectRatio="none" style="width:1601px;height:1190px;background:#FFFFFF;" version="1.1" viewBox="0 0 1601 1190" width="1601px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1178.3672" style="stroke:#2688D4;stroke-width:1.0;" width="581.5" x="476" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="251" x="641.25" y="18.0669">Сервіс нотифікацій користувачів</text><rect fill="#FFFFFF" height="832.4531" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="559" y="291.3203"/><rect fill="#FFFFFF" height="1027.0469" style="stroke:#000000;stroke-width:2.0;" width="1584.5" x="10" y="89.7266"/><rect fill="#FFFFFF" height="908.8438" style="stroke:#000000;stroke-width:2.0;" width="1323.5" x="20" y="113.8594"/><rect fill="#FFFFFF" height="31.1328" style="stroke:#000000;stroke-width:2.0;" width="419" x="239" y="654.5781"/><rect fill="#FFFFFF" height="87.0703" style="stroke:none;stroke-width:1.0;" width="1584.5" x="10" y="1029.7031"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="354" x2="354" y1="72.7266" y2="1133.7734"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="564" x2="564" y1="72.7266" y2="1133.7734"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1001.5" x2="1001.5" y1="72.7266" y2="1133.7734"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1137.5" x2="1137.5" y1="72.7266" y2="1133.7734"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1277.5" x2="1277.5" y1="72.7266" y2="1133.7734"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1463.5" x2="1463.5" y1="72.7266" y2="1133.7734"/><path d="M254,30.1328 L454,30.1328 C459,30.1328 459,51.4297 459,51.4297 C459,51.4297 459,72.7266 454,72.7266 L254,72.7266 C249,72.7266 249,51.4297 249,51.4297 C249,51.4297 249,30.1328 254,30.1328 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M454,30.1328 C449,30.1328 449,51.4297 449,51.4297 C449,72.7266 454,72.7266 454,72.7266 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190" x="254" y="48.1279">'email-channel-notifications'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="311.5" y="64.4248">Kafka Topic</text><path d="M254,1132.7734 L454,1132.7734 C459,1132.7734 459,1154.0703 459,1154.0703 C459,1154.0703 459,1175.3672 454,1175.3672 L254,1175.3672 C249,1175.3672 249,1154.0703 249,1154.0703 C249,1154.0703 249,1132.7734 254,1132.7734 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M454,1132.7734 C449,1132.7734 449,1154.0703 449,1154.0703 C449,1175.3672 454,1175.3672 454,1175.3672 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190" x="254" y="1150.7686">'email-channel-notifications'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="311.5" y="1167.0654">Kafka Topic</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="168" x="480" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="513.5" y="45.1279">Email Channel</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="487" y="61.4248">Notification Subscriber</text><rect fill="#FFFFFF" height="46.5938" style="stroke:#2688D4;stroke-width:1.5;" width="168" x="480" y="1132.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="513.5" y="1152.7686">Email Channel</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="487" y="1169.0654">Notification Subscriber</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#2688D4;stroke-width:1.5;" width="103" x="950.5" y="41.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="957.5" y="61.4248">Audit Service</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#2688D4;stroke-width:1.5;" width="103" x="950.5" y="1132.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="957.5" y="1152.7686">Audit Service</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#2688D4;stroke-width:1.5;" width="148" x="1063.5" y="41.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="1070.5" y="61.4248">Поштовий Сервер</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#2688D4;stroke-width:1.5;" width="148" x="1063.5" y="1132.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="1070.5" y="1152.7686">Поштовий Сервер</text><path d="M1226.5,30.1328 L1328.5,30.1328 C1333.5,30.1328 1333.5,51.4297 1333.5,51.4297 C1333.5,51.4297 1333.5,72.7266 1328.5,72.7266 L1226.5,72.7266 C1221.5,72.7266 1221.5,51.4297 1221.5,51.4297 C1221.5,51.4297 1221.5,30.1328 1226.5,30.1328 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1328.5,30.1328 C1323.5,30.1328 1323.5,51.4297 1323.5,51.4297 C1323.5,72.7266 1328.5,72.7266 1328.5,72.7266 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="1226.5" y="48.1279">'audit-events'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1235" y="64.4248">Kafka Topic</text><path d="M1226.5,1132.7734 L1328.5,1132.7734 C1333.5,1132.7734 1333.5,1154.0703 1333.5,1154.0703 C1333.5,1154.0703 1333.5,1175.3672 1328.5,1175.3672 L1226.5,1175.3672 C1221.5,1175.3672 1221.5,1154.0703 1221.5,1154.0703 C1221.5,1154.0703 1221.5,1132.7734 1226.5,1132.7734 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1328.5,1132.7734 C1323.5,1132.7734 1323.5,1154.0703 1323.5,1154.0703 C1323.5,1175.3672 1328.5,1175.3672 1328.5,1175.3672 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="1226.5" y="1150.7686">'audit-events'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1235" y="1167.0654">Kafka Topic</text><path d="M1348.5,30.1328 L1579.5,30.1328 C1584.5,30.1328 1584.5,51.4297 1584.5,51.4297 C1584.5,51.4297 1584.5,72.7266 1579.5,72.7266 L1348.5,72.7266 C1343.5,72.7266 1343.5,51.4297 1343.5,51.4297 C1343.5,51.4297 1343.5,30.1328 1348.5,30.1328 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1579.5,30.1328 C1574.5,30.1328 1574.5,51.4297 1574.5,51.4297 C1574.5,72.7266 1579.5,72.7266 1579.5,72.7266 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="221" x="1348.5" y="48.1279">'email-channel-notifications.DLT'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1421.5" y="64.4248">Kafka Topic</text><path d="M1348.5,1132.7734 L1579.5,1132.7734 C1584.5,1132.7734 1584.5,1154.0703 1584.5,1154.0703 C1584.5,1154.0703 1584.5,1175.3672 1579.5,1175.3672 L1348.5,1175.3672 C1343.5,1175.3672 1343.5,1154.0703 1343.5,1154.0703 C1343.5,1154.0703 1343.5,1132.7734 1348.5,1132.7734 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:2.0;"/><path d="M1579.5,1132.7734 C1574.5,1132.7734 1574.5,1154.0703 1574.5,1154.0703 C1574.5,1175.3672 1579.5,1175.3672 1579.5,1175.3672 " fill="none" style="stroke:#2688D4;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="221" x="1348.5" y="1150.7686">'email-channel-notifications.DLT'</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1421.5" y="1167.0654">Kafka Topic</text><rect fill="#FFFFFF" height="832.4531" style="stroke:#2688D4;stroke-width:1.0;" width="10" x="559" y="291.3203"/><path d="M10,89.7266 L74,89.7266 L74,96.7266 L64,106.7266 L10,106.7266 L10,89.7266 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1027.0469" style="stroke:#000000;stroke-width:2.0;" width="1584.5" x="10" y="89.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="102.7935">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="174" x="89" y="101.937">[Відправка повідомлення]</text><path d="M20,113.8594 L97,113.8594 L97,120.8594 L87,130.8594 L20,130.8594 L20,113.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="908.8438" style="stroke:#000000;stroke-width:2.0;" width="1323.5" x="20" y="113.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="35" y="126.9263">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="618" x="112" y="126.0698">[Виконання N спроб на відправку згідно налаштувань у разі помилки обробки повідомлення]</text><polygon fill="#2688D4" points="365,287.3203,355,291.3203,365,295.3203,361,291.3203" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="359" x2="558" y1="291.3203" y2="291.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="371" y="271.1216">Зчитування запиту</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="371" y="286.2544">на відправку повідомлення</text><path d="M30,135.9922 L30,417.9922 L349,417.9922 L349,145.9922 L339,135.9922 L30,135.9922 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M339,135.9922 L339,145.9922 L349,145.9922 L339,135.9922 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="36" y="153.0591">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="44" y="168.1919">"context": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="52" y="183.3247">"system": "Low-code Platform",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="52" y="198.4575">"application": "&lt;bpms.app.name&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="52" y="213.5903">"businessProcess": "&lt;optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="52" y="228.7231">"businessProcessDefinitionId": "&lt;optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="52" y="243.856">"businessProcessInstanceId": "&lt;optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="52" y="258.9888">"businessActivity": "&lt;optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268" x="52" y="274.1216">"businessActivityInstanceId": "&lt;optional&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="44" y="289.2544">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="44" y="304.3872">"notification": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="52" y="319.52">"subject": "&lt;notification subject&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="52" y="334.6528">"message": "&lt;notification message&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="44" y="349.7856">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="44" y="364.9185">"recipient": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="52" y="380.0513">"email": "&lt;Email користувача&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="44" y="395.1841">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="36" y="410.3169">}</text><line style="stroke:#2688D4;stroke-width:1.0;" x1="569" x2="611" y1="459.6484" y2="459.6484"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="611" x2="611" y1="459.6484" y2="472.6484"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="570" x2="611" y1="472.6484" y2="472.6484"/><polygon fill="#2688D4" points="580,468.6484,570,472.6484,580,476.6484,576,472.6484" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="576" y="439.4497">Побудова об'єкту повідомлення</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="576" y="454.5825">з даних запиту на відправку</text><polygon fill="#2688D4" points="1125.5,531.0469,1135.5,535.0469,1125.5,539.0469,1129.5,535.0469" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="569" x2="1131.5" y1="535.0469" y2="535.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="576" y="529.981">Відправка поштового повідомлення</text><path d="M387,485.6484 L387,570.6484 L554,570.6484 L554,495.6484 L544,485.6484 L387,485.6484 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M544,485.6484 L544,495.6484 L554,495.6484 L544,485.6484 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="393" y="502.7153">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="409" y="517.8481">"to": {email},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="409" y="532.981">"subject": {subject},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="409" y="548.1138">"text:": {message}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="393" y="563.2466">}</text><polygon fill="#2688D4" points="580,593.4453,570,597.4453,580,601.4453,576,597.4453" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="574" x2="1136.5" y1="597.4453" y2="597.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="586" y="592.3794">Повідомлення відправлено</text><line style="stroke:#2688D4;stroke-width:1.0;" x1="569" x2="611" y1="626.5781" y2="626.5781"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="611" x2="611" y1="626.5781" y2="639.5781"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="570" x2="611" y1="639.5781" y2="639.5781"/><polygon fill="#2688D4" points="580,635.5781,570,639.5781,580,643.5781,576,639.5781" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="576" y="621.5122">Обробка результату відправки повідомлення</text><path d="M239,654.5781 L303,654.5781 L303,661.5781 L293,671.5781 L239,671.5781 L239,654.5781 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="31.1328" style="stroke:#000000;stroke-width:2.0;" width="419" x="239" y="654.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="254" y="667.645">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="178" x="318" y="666.7886">[У разі помилки відправки]</text><polygon fill="#2688D4" points="365,673.7109,355,677.7109,365,681.7109,361,677.7109" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="359" x2="558" y1="677.7109" y2="677.7109"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="569" x2="611" y1="713.8438" y2="713.8438"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="611" x2="611" y1="713.8438" y2="726.8438"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="570" x2="611" y1="726.8438" y2="726.8438"/><polygon fill="#2688D4" points="580,722.8438,570,726.8438,580,730.8438,576,726.8438" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="576" y="708.7778">Формування події аудиту</text><polygon fill="#2688D4" points="990,830.6406,1000,834.6406,990,838.6406,994,834.6406" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="569" x2="996" y1="834.6406" y2="834.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="576" y="829.5747">Фіксація події аудиту</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="193" x="727" y="829.5747">SEND_USER_NOTIFICATION</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="924" y="829.5747">(success)</text><path d="M188,739.8438 L188,915.8438 L554,915.8438 L554,749.8438 L544,739.8438 L188,739.8438 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><path d="M544,739.8438 L544,749.8438 L554,749.8438 L544,739.8438 " fill="#FFFFFF" style="stroke:#2688D4;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="194" y="756.9106">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="202" y="772.0435">"notification": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="210" y="787.1763">"channel:": "email",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270" x="210" y="802.3091">"subject": "&lt;Заголовок повідомлення&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="210" y="817.4419">"message": "&lt;Повідомлення&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="210" y="832.5747">"recipient": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="321" x="218" y="847.7075">"id": "&lt;Ідентифікатор користувача - optional&gt;",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290" x="218" y="862.8403">"email": "&lt;Поштова адреса користувача&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="210" y="877.9731">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="202" y="893.106">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="194" y="908.2388">}</text><polygon fill="#2688D4" points="1265.5,938.4375,1275.5,942.4375,1265.5,946.4375,1269.5,942.4375" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="1002" x2="1271.5" y1="942.4375" y2="942.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="1009" y="937.3716">Публікація події аудиту</text><polygon fill="#2688D4" points="1013,952.4375,1003,956.4375,1013,960.4375,1009,956.4375" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1007" x2="1276.5" y1="956.4375" y2="956.4375"/><polygon fill="#2688D4" points="580,981.5703,570,985.5703,580,989.5703,576,985.5703" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="574" x2="1001" y1="985.5703" y2="985.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="586" y="980.5044">OK</text><polygon fill="#2688D4" points="365,1010.7031,355,1014.7031,365,1018.7031,361,1014.7031" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="359" x2="558" y1="1014.7031" y2="1014.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="371" y="1009.6372">Подію опрацьовано: ACK</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1594.5" y1="1030.7031" y2="1030.7031"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="210" x="15" y="1040.9136">[Повідомлення не відправлено]</text><polygon fill="#2688D4" points="1452,1061.6406,1462,1065.6406,1452,1069.6406,1456,1065.6406" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;" x1="569" x2="1458" y1="1065.6406" y2="1065.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="576" y="1060.5747">Публікації події в Dead Letter Topic</text><polygon fill="#2688D4" points="580,1075.6406,570,1079.6406,580,1083.6406,576,1079.6406" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="574" x2="1463" y1="1079.6406" y2="1079.6406"/><polygon fill="#2688D4" points="365,1104.7734,355,1108.7734,365,1112.7734,361,1108.7734" style="stroke:#2688D4;stroke-width:1.0;"/><line style="stroke:#2688D4;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="359" x2="558" y1="1108.7734" y2="1108.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="371" y="1103.7075">Подію опрацьовано: ACK</text><!--MD5=[bac7b448534e23c483a2e1c8120ff730]
@startuml
skinparam shadowing false
skinparam DatabaseBackgroundColor white
skinparam DatabaseBorderColor #2688d4
skinparam QueueBackgroundColor white
skinparam QueueBorderColor #2688d4
skinparam NoteBackgroundColor white
skinparam NoteBorderColor #2688d4
skinparam sequence {
    ArrowColor #2688d4
    ActorBorderColor #2688d4
    LifeLineBorderColor #2688d4
    ParticipantBorderColor #2688d4
    ParticipantBackgroundColor white
    BoxBorderColor #2688d4
    BoxBackgroundColor white
}

queue "'email-channel-notifications'\n Kafka Topic" as email_notifications_kafka_topic
box "Сервіс нотифікацій користувачів"
  participant "Email Channel \nNotification Subscriber" as email_channel_notification_subscriber
  participant "Audit Service" as audit_service
end box
participant "Поштовий Сервер" as mail_server
queue "'audit-events'\n Kafka Topic" as audit_events_kafka_topic
queue "'email-channel-notifications.DLT'\n Kafka Topic" as email_notifications_dlt_kafka_topic

alt Відправка повідомлення
  loop Виконання N спроб на відправку згідно налаштувань у разі помилки обробки повідомлення
  email_channel_notification_subscriber -> email_notifications_kafka_topic: Зчитування запиту \nна відправку повідомлення
  note left
  {
    "context": {
      "system": "Low-code Platform",
      "application": "<bpms.app.name>",
      "businessProcess": "<optional>",
      "businessProcessDefinitionId": "<optional>",
      "businessProcessInstanceId": "<optional>",
      "businessActivity": "<optional>",
      "businessActivityInstanceId": "<optional>"
    },
    "notification": {
      "subject": "<notification subject>",
      "message": "<notification message>"
    },
    "recipient": {
      "email": "<Email користувача>"
    }
  }
  end note

  activate email_channel_notification_subscriber
    email_channel_notification_subscriber -> email_channel_notification_subscriber: Побудова об'єкту повідомлення \nз даних запиту на відправку
    email_channel_notification_subscriber -> mail_server: Відправка поштового повідомлення
      note left
        {
            "to": {email},
            "subject": {subject},
            "text:": {message}
        }
      end note
      mail_server - -> email_channel_notification_subscriber: Повідомлення відправлено
      email_channel_notification_subscriber -> email_channel_notification_subscriber: Обробка результату відправки повідомлення
      alt У разі помилки відправки
        email_channel_notification_subscriber - -> email_notifications_kafka_topic
      end

      email_channel_notification_subscriber -> email_channel_notification_subscriber: Формування події аудиту
      email_channel_notification_subscriber -> audit_service: Фіксація події аудиту **SEND_USER_NOTIFICATION** (success)
      note left
      {
        "notification": {
          "channel:": "email",
          "subject": "<Заголовок повідомлення>",
          "message": "<Повідомлення>",
          "recipient": {
            "id": "<Ідентифікатор користувача - optional>",
            "email": "<Поштова адреса користувача>"
          }
        }
      }
      end note
      audit_service -> audit_events_kafka_topic: Публікація події аудиту
      audit_events_kafka_topic - -> audit_service
      audit_service - -> email_channel_notification_subscriber: OK
      email_channel_notification_subscriber - -> email_notifications_kafka_topic: Подію опрацьовано: ACK
  end
else Повідомлення не відправлено
    email_channel_notification_subscriber -> email_notifications_dlt_kafka_topic: Публікації події в Dead Letter Topic
    email_notifications_dlt_kafka_topic - -> email_channel_notification_subscriber
    email_channel_notification_subscriber - -> email_notifications_kafka_topic: Подію опрацьовано: ACK
end
deactivate email_channel_notification_subscriber
@enduml

PlantUML version 1.2021.7(Sun May 23 12:40:07 UTC 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>